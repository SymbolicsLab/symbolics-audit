# ADR-001: Configuration Representation for FDE Extension

**Status**: Accepted
**Date**: 2026-02-01
**Deciders**: User (with input from Claude Opus, ChatGPT, Gemini, Claude Code)
**Context**: F.1 Logic Substrate Investigation

---

## Scope Clarification

**FDE-fold formalizes Level 2+ stabilization, not distinction itself.**

Distinction is pre-logical and pre-propositional. The entire theory claims that logic is *generated by* distinction, not the other way around. Formalizing in FDE means we are inside the *product* of distinction—we are modeling what happens after atoms exist, not the act that creates them.

This is intentional and honest:
- **Levels 2+** (propositional structure, stabilization within distinguished domains): FDE-fold applies here
- **Levels -1/0/1** (pre-cut field, the act of distinction, domain creation): Formally open. May require topological, game-theoretic, or other pre-propositional substrate.

The FDE work is a *layer* of formalization, not a placeholder for the whole theory. See ADR-002 for the open thread on pre-propositional formalization.

---

## Decision

**Immediate implementation**: Option A (pair of finite sets, implicit Neither)
**Target end-state**: Option A′ (finite-domain total map to FOUR)

Fold will be refactored to use **Setoids** (equivalence relation, not canonical representatives) to handle the quotient problem under --safe --without-K.

---

## Context

The theory requires four commitment states:
- **Neither**: no polarity commitment
- **In**: positive commitment only
- **Out**: negative commitment only
- **Both**: contradictory commitment

Current Agda proofs use LP (three values: T, F, B). LP lacks Neither (gaps). The question: how should configurations represent the four-valued FDE ontology?

Three agents contributed:
- **Gemini**: Recommended bilattice L₄, suggested "fold operates on knowledge-ordering"
- **Claude Opus**: Recommended Option A (pairs), Neither-as-absence, Setoids for fold
- **ChatGPT**: Critiqued both, identified Option A′ as the right target

---

## Options Considered

### Option A: Pair of Finite Sets (Pos, Neg)

```
Config = (Pos : Finset Atom, Neg : Finset Atom)
```

- Neither = atom ∉ Pos ∧ atom ∉ Neg (implicit)
- In = atom ∈ Pos ∧ atom ∉ Neg
- Out = atom ∉ Pos ∧ atom ∈ Neg
- Both = atom ∈ Pos ∧ atom ∈ Neg

**Pros**: Matches current LP setup, minimal change, constructively tractable
**Cons**: Cannot distinguish "not yet introduced" from "introduced but gapped"

### Option B: Total Map (Atom → FOUR)

```
Config = Atom → FOUR
```

**Pros**: Neither is explicit and first-class
**Cons**: Requires global atom domain, "contemplative" rather than "generative" picture

### Option A′: Finite-Domain Total Map (RECOMMENDED TARGET)

```
Config = (Domain : Finset Atom, val : Atom → FOUR)
-- with: a ∉ Domain → val a = N (or unspecified outside Domain)
```

- Pre-cut field = empty Domain
- "Not yet introduced" = atom ∉ Domain
- "Introduced but gapped" = atom ∈ Domain ∧ val atom = N
- Explicit in-domain gaps without global atom universe

**Pros**:
- Clean separation of "not in scope" vs "in scope but uncommitted"
- Bilattice-native (pointwise order over Domain)
- Scales to connectives
- No ambiguity about Neither's meaning

**Cons**: More complex than Option A

### Option C: Theory (Set of Formulas with Closure)

**Rejected**: Too heavy, infinite objects, quotient problem worse

---

## The Core Ontological Decision

**Neither is absence, not a value.**

The pre-cut field is *prior to distinction*—it's not a determination among four options, it's the condition before there are options. Marking every atom as N across a predefined domain is a "contemplative" picture (a god surveying all possible distinctions). That's not what cut does. Cut *creates* the atom.

However, once an atom has been cut into existence, it may need to lose commitment and become a gap (unfold). This requires distinguishing:
- **Not in scope**: atom hasn't been distinguished yet
- **In scope but gapped**: atom was introduced but currently uncommitted

Option A conflates these. Option A′ separates them. We implement A now and migrate to A′ when unfold requires it.

---

## Fold Definition

### Current (LP)
Fold is "canonical normalization"—the coarsest map preserving what LP entailment is sensitive to.

### Target (FDE)
Fold should normalize under FDE consequence. Since FDE has more valuations (gaps allowed), FDE consequence is weaker, and FDE-fold produces finer-grained equivalence classes.

### Implementation Approach: Setoids

Under --safe --without-K, we cannot assume unique identity proofs. Picking canonical representatives constructively is hard (the quotient problem).

**Solution**: Define FDE-equivalence as a relation on configurations (mutual FDE-entailment) and work with the Setoid. This:
- Avoids Cubical Agda / HITs
- Is honest about "same up to FDE" being a relation
- Compatible with current flags

**Consequence**: The three properties must be restated:
- **Idempotence**: `fold (fold Φ) ≈ fold Φ` (where ≈ is setoid equivalence)
- **Conservativity**: Needs clarification (see below)
- **Contradiction-preservation**: `+a ∈ Φ ∧ -a ∈ Φ → +a ∈ fold Φ ∧ -a ∈ fold Φ` (or setoid equivalent)

---

## Conservativity Clarification

The current property `atoms(fold(Φ)) ⊆ atoms(Φ)` needs restatement for A′:

Three possible interpretations:
1. **Domain-conservativity**: `Domain(fold Φ) = Domain(Φ)` — fold doesn't change what's in scope
2. **Support-conservativity**: atoms with non-N value don't increase
3. **Polarity-conservativity**: Pos/Neg don't introduce new atoms outside Domain

For Option A (current), these coincide. For Option A′, they're distinct.

**Decision**: Domain-conservativity is the intent. Fold doesn't introduce new distinctions; it stabilizes existing commitments.

---

## Bilattice Framing: Corrected

Gemini claimed "fold operates on the knowledge-ordering." Claude Opus claimed "fold is truth-side." Both are partially wrong.

**Corrected position**:

The bilattice L₄ has two orderings:
- **≤ₜ (truth)**: F ≤ₜ {N, B} ≤ₜ T — governs entailment/consequence
- **≤ₖ (knowledge)**: N ≤ₖ {T, F} ≤ₖ B — governs information/determination

Fold *can* live on ≤ₖ (as a closure operator increasing determination) **if configurations are modeled as finite-domain FOUR-valuations (Option A′)**. With Option A (implicit Neither), conservativity as currently stated blocks movement from N to {T, F, B} because N atoms aren't "in" the configuration.

The bilattice framing becomes fully applicable when we migrate to A′. For now (Option A), fold is best understood as truth-side normalization on atoms already committed.

---

## Unfold: Deferred

Unfold probably decomposes into multiple mechanisms:
1. **Destabilization**: weakening commitments within fixed domain (T/F/B → N)
2. **Domain expansion**: introducing new atoms via cut
3. **Interaction**: fold/unfold as dialogue between configurations

These are genuinely different operations. We should not try to unify them prematurely.

**Decision**: Unfold formalization is deferred. Build FDE-fold first; let the theory clarify what unfold needs.

---

## Migration Path

### Phase 1 (Session 2): FDE-fold on Option A
- Keep existing Config type (pair of finite sets)
- Define FDE consequence relation
- Define FDE-equivalence Setoid on configurations
- Re-prove idempotence, conservativity, contradiction-preservation (restated for Setoid)
- Do NOT change Config data type

### Phase 2 (When unfold requires it): Migrate to Option A′
- Introduce Domain as explicit component
- Distinguish "not in scope" from "in-domain gap"
- Redefine fold as closure on ≤ₖ (knowledge ordering)
- Restate conservativity as domain-conservativity

### Phase 3 (Speculative): Dialogical extension
- If fold-as-dialogue proves necessary, investigate game semantics
- May require going beyond algebraic bilattices

---

## What This ADR Does NOT Decide

- Whether unfold creates in-domain gaps, expands domains, or both
- Whether fold-as-dialogue requires game semantics
- The specific syntax of FDE consequence (connectives, designated values)
- Whether Cubical Agda will eventually be needed

These remain open and should be flagged in state.yaml.

---

## References

- Belnap, N. D. (1977). "A Useful Four-Valued Logic"
- Fitting, M. (1990). "Bilattices and the theory of truth"
- Gemini F.1 survey: `INTEGRATION/prompts/gemini-F1-logic-substrate-response.md`
- Claude Opus response: `INTEGRATION/prompts/opus-F1-configuration-design.md`
- ChatGPT critiques: inline in session
